-- ============================================
-- QUICK RESET FOR TESTING
-- Resets UPSI24 activity back to 'setup'
-- ============================================

DO $$
DECLARE
    v_activity_id UUID;
BEGIN
    -- Get UPSI24 activity
    SELECT id INTO v_activity_id
    FROM activities
    WHERE join_code = 'UPSI24';
    
    IF v_activity_id IS NULL THEN
        RAISE NOTICE '❌ Activity UPSI24 not found!';
        RETURN;
    END IF;
    
    -- Delete old test data
    DELETE FROM team_progress 
    WHERE team_id IN (
        SELECT id FROM teams WHERE activity_id = v_activity_id
    );
    
    DELETE FROM participants WHERE activity_id = v_activity_id;
    DELETE FROM teams WHERE activity_id = v_activity_id;
    
    -- Reset activity to setup status
    UPDATE activities
    SET 
        status = 'setup',
        game_started_at = NULL,
        game_ended_at = NULL,
        lobby_started_at = NULL
    WHERE id = v_activity_id;
    
    RAISE NOTICE '✅ UPSI24 reset! You can join again now.';
END $$;

-- Verify
SELECT 
    name,
    join_code,
    status,
    (SELECT COUNT(*) FROM participants WHERE activity_id = activities.id) as participants
FROM activities
WHERE join_code = 'UPSI24';
